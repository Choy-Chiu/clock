<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº’å‹•æ•™å­¸æ™‚é˜</title>
    <style>
        body { display: flex; flex-direction: column; align-items: center; font-family: sans-serif; background: #fdfaf0; margin: 0; padding: 20px; touch-action: none; }
        #target-box { background: white; padding: 15px 30px; border-radius: 50px; border: 4px solid #f39c12; margin-bottom: 20px; }
        #target-time { font-size: 28px; color: #d35400; font-weight: bold; margin: 0; }
        #clock-container { width: 320px; height: 320px; position: relative; }
        svg { width: 100%; height: 100%; border-radius: 50%; background: white; box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
        .minute-marker-all { font-size: 3px; fill: #95a5a6; }
        .minute-marker-5 { font-size: 4px; fill: #e67e22; font-weight: bold; }
        .hour-marker { font-size: 8px; fill: #2c3e50; font-weight: bold; }
        .hand { stroke-linecap: round; cursor: pointer; }
        #feedback { margin-top: 15px; font-size: 20px; font-weight: bold; height: 1.5em; text-align: center; }
        .button-group { display: flex; gap: 15px; margin-top: 20px; }
        .btn { padding: 12px 25px; font-size: 18px; border-radius: 12px; border: none; color: white; font-weight: bold; cursor: pointer; }
        .btn-check { background: #27ae60; box-shadow: 0 4px 0 #219150; }
        .btn-next { background: #3498db; box-shadow: 0 4px 0 #2980b9; }
    </style>
</head>
<body>

    <div id="target-box">
        <p id="target-time">è¼‰å…¥ä¸­...</p>
    </div>
    
    <div id="clock-container">
        <svg id="clock-svg" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="48" fill="white" stroke="#333" stroke-width="0.5"/>
            <g id="clock-face"></g>
            <line id="hour-hand" x1="50" y1="50" x2="50" y2="32" stroke="#2c3e50" stroke-width="3" />
            <line id="minute-hand" x1="50" y1="50" x2="50" y2="18" stroke="#3498db" stroke-width="1.8" />
            <circle cx="50" cy="50" r="2.5" fill="#e74c3c"/>
        </svg>
    </div>

    <div id="feedback">è«‹é»æ“ŠæŒ‡é‡é–‹å§‹æ’¥å‹•</div>

    <div class="button-group">
        <button class="btn btn-check" onclick="manualCheck()">æˆ‘èª¿æ•´å¥½äº†ï¼</button>
        <button class="btn btn-next" onclick="generateTask()">æ›ä¸€é¡Œ</button>
    </div>

    <script>
        // ç›´æ¥å®£å‘Šè®Šæ•¸
        const clockFace = document.getElementById('clock-face');
        const hourHand = document.getElementById('hour-hand');
        const minuteHand = document.getElementById('minute-hand');
        const feedback = document.getElementById('feedback');
        const targetDisplay = document.getElementById('target-time');
        
        let currentH = 12; 
        let currentM = 0;  
        let tH = 12, tM = 0;

        // ç”Ÿæˆé˜é¢åˆ»åº¦
        function drawFace() {
            let html = '';
            for (let i = 1; i <= 60; i++) {
                const angle = i * 6 * (Math.PI / 180);
                const x = 50 + 44 * Math.sin(angle);
                const y = 50 - 44 * Math.cos(angle);
                const isBig = i % 5 === 0;
                html += `<text x="${x}" y="${y+1.2}" text-anchor="middle" class="${isBig?'minute-marker-5':'minute-marker-all'}">${i===60?0:i}</text>`;
            }
            for (let i = 1; i <= 12; i++) {
                const angle = i * 30 * (Math.PI / 180);
                const x = 50 + 34 * Math.sin(angle);
                const y = 50 - 34 * Math.cos(angle);
                html += `<text x="${x}" y="${y+2.5}" text-anchor="middle" class="hour-marker">${i}</text>`;
            }
            clockFace.innerHTML = html;
        }

        function updateHands() {
            minuteHand.setAttribute('transform', `rotate(${currentM * 6}, 50, 50)`);
            hourHand.setAttribute('transform', `rotate(${(currentH % 12) * 30 + currentM * 0.5}, 50, 50)`);
        }

        function move(e) {
            e.preventDefault();
            const rect = document.getElementById('clock-svg').getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            const x = clientX - (rect.left + rect.width / 2);
            const y = clientY - (rect.top + rect.height / 2);
            let angle = Math.atan2(y, x) * (180 / Math.PI) + 90;
            if (angle < 0) angle += 360;

            if (this.id === 'minute-hand') {
                let newM = Math.round(angle / 6) % 60;
                if (currentM === 59 && newM === 0) currentH = (currentH % 12) + 1;
                else if (currentM === 0 && newM === 59) currentH = (currentH - 1 <= 0) ? 12 : currentH - 1;
                currentM = newM;
            } else {
                currentH = Math.floor(angle / 30) || 12;
                currentM = Math.round((angle % 30) * 2);
            }
            updateHands();
            feedback.innerText = "èª¿æ•´ä¸­...";
        }

        function generateTask() {
            tH = Math.floor(Math.random() * 12) || 12;
            tM = Math.floor(Math.random() * 60);
            targetDisplay.innerText = `è«‹èª¿æ•´åˆ°ï¼š${tH} é» ${tM.toString().padStart(2, '0')} åˆ†`;
            feedback.innerText = "è«‹æ’¥å‹•æŒ‡é‡";
            feedback.style.color = "#2c3e50";
        }

        function manualCheck() {
            if (currentH === tH && currentM === tM) {
                feedback.innerText = "ğŸŒŸ ç­”å°äº†ï¼ä½ å¤ªæ£’äº†ï¼";
                feedback.style.color = "#27ae60";
            } else {
                feedback.innerText = `ç¾åœ¨æ˜¯ ${currentH}:${currentM.toString().padStart(2, '0')}ï¼Œå†è©¦è©¦ï¼`;
                feedback.style.color = "#e74c3c";
            }
        }

        function init() {
            drawFace();
            generateTask();
            updateHands();

            const start = function(e) {
                const binder = move.bind(this);
                const stop = () => {
                    window.removeEventListener('mousemove', binder);
                    window.removeEventListener('touchmove', binder);
                };
                window.addEventListener('mousemove', binder);
                window.addEventListener('touchmove', binder, {passive:false});
                window.addEventListener('mouseup', stop, {once:true});
                window.addEventListener('touchend', stop, {once:true});
            };

            minuteHand.addEventListener('mousedown', start);
            minuteHand.addEventListener('touchstart', start, {passive:false});
            hourHand.addEventListener('mousedown', start);
            hourHand.addEventListener('touchstart', start, {passive:false});
        }

        // ç¢ºä¿ DOM è¼‰å…¥å¾Œç«‹å³åŸ·è¡Œ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
